<!doctype html><html lang=en><head><title>Fixing High Disk Usage and Unexpected MariaDB Kills with innodb_buffer_pool_size ::
/home/jackblk
</title><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content="My client has a few Wordpress websites and they ran into a strange issue. The stack is quite simple, just Wordpress and MariaDB both running in Docker, on Google Cloud.
When it happens, the server doesn&rsquo;t respond, timing out. The VM is inaccessible, cannot SSH to the VM. We checked the log of both Wordpress and MariaDB, but couldn&rsquo;t find anything useful to identify the issue. There was only normal logs, and then timing out.
"><meta name=keywords content><meta name=robots content="noodp"><link rel=canonical href=https://blog.haicon.moe/posts/2025-08-08-fixing-high-disk-usage-and-unexpected-mariadb-kills-with-innodbbufferpoolsize/><link rel=stylesheet href=/css/style.min.ec64fbf1e3ffdeff16808f9fc87596f8307ebbc0fd5c1cade9a6dfe9dacab6cc.css integrity="sha256-7GT78eP/3v8WgI+fyHWW+DB+u8D9XByt6abf6drKtsw=" crossorigin=anonymous><link rel=stylesheet href=https://blog.haicon.moe/style.css><link rel=apple-touch-icon-precomposed sizes=144x144 href=https://blog.haicon.moe/img/apple-touch-icon-144-precomposed.png><link rel="shortcut icon" href=https://blog.haicon.moe/img/favicon.png><link href=/fonts/Inter-Italic.woff2 rel=preload type=font/woff2 as=font crossorigin><link href=/fonts/Inter-Regular.woff2 rel=preload type=font/woff2 as=font crossorigin><link href=/fonts/Inter-Medium.woff2 rel=preload type=font/woff2 as=font crossorigin><link href=/fonts/Inter-MediumItalic.woff2 rel=preload type=font/woff2 as=font crossorigin><link href=/fonts/Inter-Bold.woff2 rel=preload type=font/woff2 as=font crossorigin><link href=/fonts/Inter-BoldItalic.woff2 rel=preload type=font/woff2 as=font crossorigin><meta name=twitter:card content="summary"><meta name=twitter:title content="Fixing High Disk Usage and Unexpected MariaDB Kills with innodb_buffer_pool_size"><meta name=twitter:description content="My client has a few Wordpress websites and they ran into a strange issue. The stack is quite simple, just Wordpress and MariaDB both running in Docker, on Google Cloud.
When it happens, the server doesn‚Äôt respond, timing out. The VM is inaccessible, cannot SSH to the VM. We checked the log of both Wordpress and MariaDB, but couldn‚Äôt find anything useful to identify the issue. There was only normal logs, and then timing out."><meta property="og:url" content="https://blog.haicon.moe/posts/2025-08-08-fixing-high-disk-usage-and-unexpected-mariadb-kills-with-innodbbufferpoolsize/"><meta property="og:site_name" content="/home/jackblk"><meta property="og:title" content="Fixing High Disk Usage and Unexpected MariaDB Kills with innodb_buffer_pool_size"><meta property="og:description" content="My client has a few Wordpress websites and they ran into a strange issue. The stack is quite simple, just Wordpress and MariaDB both running in Docker, on Google Cloud.
When it happens, the server doesn‚Äôt respond, timing out. The VM is inaccessible, cannot SSH to the VM. We checked the log of both Wordpress and MariaDB, but couldn‚Äôt find anything useful to identify the issue. There was only normal logs, and then timing out."><meta property="og:locale" content="en"><meta property="og:type" content="article"><meta property="article:section" content="posts"><meta property="article:published_time" content="2025-08-08T00:00:00+00:00"><meta property="article:modified_time" content="2025-08-08T17:15:51+07:00"><meta property="article:tag" content="English"><meta property="article:tag" content="Wordpress"><meta property="article:tag" content="Mariadb"><meta property="article:tag" content="Til"></head><body class=dark-theme><div class=container><header class=header><span class=header__inner><a href=/ class=logo style=text-decoration:none><span class=logo__mark><svg class="greater-icon" viewBox="0 0 44 44"><path fill="none" d="M15 8l14.729 14.382L15 35.367"/></svg>
</span><span class=logo__text>/home/jackblk üêà</span>
<span class=logo__cursor></span>
</a><span class=header__right><nav class=menu><ul class="menu__inner menu__inner--desktop"><li><a href=/about/>about</a></li><li><a href=/tags/>tags</a></li></ul><ul class="menu__inner menu__inner--mobile"><li><a href=/about/>about</a></li><li><a href=/tags/>tags</a></li></ul></nav><span class=menu-trigger><svg viewBox="0 0 24 24"><path d="M0 0h24v24H0z" fill="none"/><path d="M3 18h18v-2H3v2zm0-5h18v-2H3v2zm0-7v2h18V6H3z"/></svg>
</span><span class=theme-toggle><svg class="theme-toggler" width="24" height="24" viewBox="0 0 48 48" fill="none"><path d="M22 41c10.4934.0 19-8.5066 19-19C41 11.5066 32.4934 3 22 3 11.5066 3 3 11.5066 3 22s8.5066 19 19 19zM7 22C7 13.7157 13.7157 7 22 7V37C13.7157 37 7 30.2843 7 22z"/></svg></span></span></span></header><div class=content><article class=post><h1 class=post-title>Fixing High Disk Usage and Unexpected MariaDB Kills with innodb_buffer_pool_size</h1><div class=post-meta><time class=post-date>2025-08-08
</time><span class=post-read-time>‚Äî 3 min read</span></div><span class=post-tags><a href=https://blog.haicon.moe/tags/english/>#english</a>&nbsp;
<a href=https://blog.haicon.moe/tags/wordpress/>#wordpress</a>&nbsp;
<a href=https://blog.haicon.moe/tags/mariadb/>#mariadb</a>&nbsp;
<a href=https://blog.haicon.moe/tags/til/>#til</a>&nbsp;</span><div class=post-content><p>My client has a few Wordpress websites and they ran into a strange issue. The stack is quite simple, just Wordpress and MariaDB both running in Docker, on Google Cloud.</p><p>When it happens, the server doesn&rsquo;t respond, timing out. The VM is inaccessible, cannot SSH to the VM. We checked the log of both Wordpress and MariaDB, but couldn&rsquo;t find anything useful to identify the issue. There was only normal logs, and then timing out.</p><p>They used to get attacked/DDoS, so we suspected that. But looking at the metrics at that moment, it didn‚Äôt make sense. There was no huge burst of external connection to the VM, so there was no attack, at least on application layer (we route the whole site through Cloudflare for DDoS protection).</p><p>The metrics looked fine, for the most parts:</p><p><img src=/images/blog-wordpress-mariadb-crash-vm/metrics.webp alt></p><ul><li><p>Just a burst of CPU, then it returned to normal</p></li><li><p>RAM is not full, only ~50% utilization</p></li><li><p>Sudden huge burst of Disk Throughput</p></li></ul><p>We didn&rsquo;t really understand the root cause, and it only happens a few times over a month, so we kinda &ldquo;ignore&rdquo; it.</p><p>A few days ago was the final straw, I jumped in to debug it for hours. Turned out it was a simple root cause and a simple fix as well.</p><h3 id=understanding-the-cause>Understanding the Cause
<a href=#understanding-the-cause class=h-anchor aria-hidden=true>#</a></h3><p>We checked the container logs, the metrics and all, but we forgot a very important part: the syslog.</p><pre tabindex=0><code>kernel: [ 8085.099452] mariadbd invoked oom-killer: gfp_mask=0x140cca(GFP_HIGHUSER_MOVABLE|__GFP_COMP), order=0, oom_score_adj=0
kernel: [ 8085.099486] CPU: 1 PID: 10069 Comm: mariadbd Not tainted 6.8.0-1033-gcp #35~22.04.1-Ubuntu
kernel: [ 8085.099491] Hardware name: Google Google Compute Engine/Google Compute Engine, BIOS Google 05/07/2025
kernel: [ 8085.099497] Call Trace:
kernel: [ 8085.099503] &lt;TASK&gt;
kernel: [ 8085.099521] dump_stack_lvl+0x76/0xa0
kernel: [ 8085.099631] dump_stack+0x10/0x20
kernel: [ 8085.099635] dump_header+0x47/0x200
kernel: [ 8085.099691] oom_kill_process+0x116/0x270
</code></pre><p>There it was! <code>mariadbd</code> was killed by the kernel via <code>oom-killer</code>, meaning it ran out of memory. But didn&rsquo;t the metrics said the memory utilization was only 50%? Then why it ran out of memory?</p><p>Here‚Äôs what was really happening:</p><ul><li><p>Memory wasn‚Äôt actually ‚Äúfree‚Äù in the way it seemed.</p></li><li><p>MariaDB suddenly tried to allocate a large chunk of memory.</p></li><li><p>The required memory (<code>mem_needed</code>) was greater than <code>free_mem + swap</code>.</p></li><li><p>The kernel saw the request as too big to handle and killed the process instantly.</p></li><li><p>This happened before memory utilization could visibly spike, so the chart still showed ~50% usage.</p></li></ul><p>This suggested that MariaDB‚Äôs InnoDB buffer pool was too small to cache enough data in RAM, forcing queries to constantly hit disk.</p><p>Quick check:</p><pre tabindex=0><code>MariaDB [(none)]&gt; SHOW GLOBAL VARIABLES LIKE &#39;innodb_buffer_pool_size&#39;;
+-------------------------+-----------+
| Variable_name¬† ¬† ¬† ¬† ¬† ¬†| Value¬† ¬† ¬†|
+-------------------------+-----------+
| innodb_buffer_pool_size | 134217728 |
+-------------------------+-----------+
1 row in set (0.004 sec)
</code></pre><p>Only 128MiB for <code>innodb_buffer_pool_size</code>! This is too small for Wordpress.</p><h3 id=the-fix>The Fix
<a href=#the-fix class=h-anchor aria-hidden=true>#</a></h3><p>I have 2GB RAM for the VM so I allocate:</p><ul><li><p>Set the <code>innodb_buffer_pool_size</code> to 50% of the RAM.</p></li><li><p>Limit 75% RAM for MariaDB via Docker. This means, even if the DB somehow messes it up, it will not crash the VM.</p></li></ul><pre tabindex=0><code>mariadb:
  image: mariadb:11.4
  ...
  deploy:
    resources:
      limits:
        memory: 1.5G
  command:
    - &#34;--innodb_buffer_pool_size=1G&#34;
</code></pre><h3 id=the-result>The Result
<a href=#the-result class=h-anchor aria-hidden=true>#</a></h3><p>After restarting the stack with the new settings:</p><ul><li><p>Disk throughput dropped sharply.</p></li><li><p>Page loads became noticeably faster, which is a big win for optimization that I didn&rsquo;t plan for!</p></li><li><p>No more unexpected process kills.</p></li></ul><h3 id=takeaway>Takeaway
<a href=#takeaway class=h-anchor aria-hidden=true>#</a></h3><ul><li><p>Check the app logs, metrics, but don&rsquo;t forget to check for the syslog if your system is having an issue.</p></li><li><p>Optimize your DB config.</p></li></ul></div><div class=pagination><div class=pagination__title><span class=pagination__title-h>Read other posts</span><hr></div><div class=pagination__buttons><span class="button next"><a href=https://blog.haicon.moe/posts/battlebit-server-browser/><span class=button__text>Battlebit Server Browser</span>
<span class=button__icon>‚Üí</span></a></span></div></div><script src=https://giscus.app/client.js data-repo=jackblk/blog data-repo-id=R_kgDOIuVYCA data-category=Announcements data-category-id=DIC_kwDOIuVYCM4CpDAQ data-mapping=pathname data-strict=0 data-reactions-enabled=1 data-emit-metadata=0 data-input-position=top data-theme=dark data-lang=en data-loading=lazy crossorigin=anonymous async></script><script>function setGiscusTheme(e){const t=document.querySelector("iframe.giscus-frame");if(!t)return;t.contentWindow.postMessage({giscus:{setConfig:{theme:e}}},"https://giscus.app")}const themeMap={"dark-theme":"dark","light-theme":"light"};function updateGiscusThemeFromLocalStorage(){const e=localStorage.getItem("theme"),t=themeMap[e]||"dark";setGiscusTheme(t)}document.querySelector(".theme-toggle")?.addEventListener("click",()=>{setTimeout(updateGiscusThemeFromLocalStorage,10)}),window.addEventListener("DOMContentLoaded",updateGiscusThemeFromLocalStorage)</script></article></div><footer class=footer><div class=footer__inner><a href=/ class=logo style=text-decoration:none><span class=logo__mark><svg class="greater-icon" viewBox="0 0 44 44"><path fill="none" d="M15 8l14.729 14.382L15 35.367"/></svg>
</span><span class=logo__text>/home/jackblk üêà</span>
<span class=logo__cursor></span></a><div class=copyright><span>¬© 2025 Powered by <a href=https://gohugo.io target=_blank rel=noopener>Hugo</a></span>
<span><a href=https://github.com/panr/hugo-theme-hello-friend target=_blank>Theme</a> made by <a href=https://github.com/panr target=_blank>panr</a></span></div></div></footer><script type=text/javascript src=/bundle.min.js></script></div></body></html>